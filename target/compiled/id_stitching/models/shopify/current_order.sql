





--- Outer Table -- Grab the most recent record 

Select dense_rank() over (partition by order_number order by timestamp desc ) as current_order_row, *
From (

 -- find all the possible columns and create placeholders if the don't exist

		

		

Select 	admin_graphql_api_id as admin_graphql_api_id  ,   
        anonymous_id as anonymous_id  ,   
        app_id as app_id  ,   
        browser_ip as browser_ip  ,   
        buyer_accepts_marketing as buyer_accepts_marketing  ,   
        cart_token as cart_token  ,   
        checkout_id as checkout_id  ,   
        checkout_token as checkout_token  ,   
        client_details_accept_language as client_details_accept_language  ,   
        client_details_browser_height as client_details_browser_height  ,   
        client_details_browser_ip as client_details_browser_ip  ,   
        client_details_browser_width as client_details_browser_width  ,   
        client_details_user_agent as client_details_user_agent  ,   
        NULL as closed_at  ,   
        confirmed as confirmed  ,   
        contact_email as contact_email  ,   
        context_destination_id as context_destination_id  ,   
        context_destination_type as context_destination_type  ,   
        context_integration_name as context_integration_name  ,   
        context_ip as context_ip  ,   
        context_library_name as context_library_name  ,   
        context_library_version as context_library_version  ,   
        context_request_ip as context_request_ip  ,   
        context_source_id as context_source_id  ,   
        context_source_type as context_source_type  ,   
        created_at as created_at  ,   
        currency as currency  ,   
        current_subtotal_price as current_subtotal_price  ,   
        current_subtotal_price_set_presentment_money_amount as current_subtotal_price_set_presentment_money_amount  ,   
        current_subtotal_price_set_presentment_money_currency_code as current_subtotal_price_set_presentment_money_currency_code  ,   
        current_subtotal_price_set_shop_money_amount as current_subtotal_price_set_shop_money_amount  ,   
        current_subtotal_price_set_shop_money_currency_code as current_subtotal_price_set_shop_money_currency_code  ,   
        current_total_discounts as current_total_discounts  ,   
        current_total_discounts_set_presentment_money_amount as current_total_discounts_set_presentment_money_amount  ,   
        current_total_discounts_set_presentment_money_currency_code as current_total_discounts_set_presentment_money_currency_code  ,   
        current_total_discounts_set_shop_money_amount as current_total_discounts_set_shop_money_amount  ,   
        current_total_discounts_set_shop_money_currency_code as current_total_discounts_set_shop_money_currency_code  ,   
        current_total_price as current_total_price  ,   
        current_total_price_set_presentment_money_amount as current_total_price_set_presentment_money_amount  ,   
        current_total_price_set_presentment_money_currency_code as current_total_price_set_presentment_money_currency_code  ,   
        current_total_price_set_shop_money_amount as current_total_price_set_shop_money_amount  ,   
        current_total_price_set_shop_money_currency_code as current_total_price_set_shop_money_currency_code  ,   
        current_total_tax as current_total_tax  ,   
        current_total_tax_set_presentment_money_amount as current_total_tax_set_presentment_money_amount  ,   
        current_total_tax_set_presentment_money_currency_code as current_total_tax_set_presentment_money_currency_code  ,   
        current_total_tax_set_shop_money_amount as current_total_tax_set_shop_money_amount  ,   
        current_total_tax_set_shop_money_currency_code as current_total_tax_set_shop_money_currency_code  ,   
        customer_locale as customer_locale  ,   
        discount_applications as discount_applications  ,   
        discount_codes as discount_codes  ,   
        email as email  ,   
        estimated_taxes as estimated_taxes  ,   
        event as event  ,   
        event_text as event_text  ,   
        financial_status as financial_status  ,   
        fulfillment_status as fulfillment_status  ,   
        fulfillments as fulfillments  ,   
        gateway as gateway  ,   
        id as id  ,   
        landing_site as landing_site  ,   
        landing_site_ref as landing_site_ref  ,   
        name as name  ,   
        note as note  ,   
        note_attributes as note_attributes  ,   
        number as number  ,   
        order_id as order_id  ,   
        order_number as order_number  ,   
        order_status_url as order_status_url  ,   
        original_timestamp as original_timestamp  ,   
        payment_details_avs_result_code as payment_details_avs_result_code  ,   
        payment_details_credit_card_bin as payment_details_credit_card_bin  ,   
        payment_details_credit_card_company as payment_details_credit_card_company  ,   
        payment_details_credit_card_number as payment_details_credit_card_number  ,   
        payment_details_cvv_result_code as payment_details_cvv_result_code  ,   
        payment_gateway_names as payment_gateway_names  ,   
        phone as phone  ,   
        presentment_currency as presentment_currency  ,   
        processed_at as processed_at  ,   
        processing_method as processing_method  ,   
        products as products  ,   
        received_at as received_at  ,   
        reference as reference  ,   
        referring_site as referring_site  ,   
        NULL as refunds  ,   
        sent_at as sent_at  ,   
        shipping_lines as shipping_lines  ,   
        source_identifier as source_identifier  ,   
        source_name as source_name  ,   
        subtotal_price as subtotal_price  ,   
        subtotal_price_set_presentment_money_amount as subtotal_price_set_presentment_money_amount  ,   
        subtotal_price_set_presentment_money_currency_code as subtotal_price_set_presentment_money_currency_code  ,   
        subtotal_price_set_shop_money_amount as subtotal_price_set_shop_money_amount  ,   
        subtotal_price_set_shop_money_currency_code as subtotal_price_set_shop_money_currency_code  ,   
        tags as tags  ,   
        tax as tax  ,   
        tax_lines as tax_lines  ,   
        taxes_included as taxes_included  ,   
        test as test  ,   
        timestamp as timestamp  ,   
        token as token  ,   
        total_discounts as total_discounts  ,   
        total_discounts_set_presentment_money_amount as total_discounts_set_presentment_money_amount  ,   
        total_discounts_set_presentment_money_currency_code as total_discounts_set_presentment_money_currency_code  ,   
        total_discounts_set_shop_money_amount as total_discounts_set_shop_money_amount  ,   
        total_discounts_set_shop_money_currency_code as total_discounts_set_shop_money_currency_code  ,   
        total_line_items_price as total_line_items_price  ,   
        total_line_items_price_set_presentment_money_amount as total_line_items_price_set_presentment_money_amount  ,   
        total_line_items_price_set_presentment_money_currency_code as total_line_items_price_set_presentment_money_currency_code  ,   
        total_line_items_price_set_shop_money_amount as total_line_items_price_set_shop_money_amount  ,   
        total_line_items_price_set_shop_money_currency_code as total_line_items_price_set_shop_money_currency_code  ,   
        total_outstanding as total_outstanding  ,   
        NULL as total_price  ,   
        total_price_set_presentment_money_amount as total_price_set_presentment_money_amount  ,   
        total_price_set_presentment_money_currency_code as total_price_set_presentment_money_currency_code  ,   
        total_price_set_shop_money_amount as total_price_set_shop_money_amount  ,   
        total_price_set_shop_money_currency_code as total_price_set_shop_money_currency_code  ,   
        total_price_usd as total_price_usd  ,   
        total_shipping_price_set_presentment_money_amount as total_shipping_price_set_presentment_money_amount  ,   
        total_shipping_price_set_presentment_money_currency_code as total_shipping_price_set_presentment_money_currency_code  ,   
        total_shipping_price_set_shop_money_amount as total_shipping_price_set_shop_money_amount  ,   
        total_shipping_price_set_shop_money_currency_code as total_shipping_price_set_shop_money_currency_code  ,   
        NULL as total_tax  ,   
        total_tax_set_presentment_money_amount as total_tax_set_presentment_money_amount  ,   
        total_tax_set_presentment_money_currency_code as total_tax_set_presentment_money_currency_code  ,   
        total_tax_set_shop_money_amount as total_tax_set_shop_money_amount  ,   
        total_tax_set_shop_money_currency_code as total_tax_set_shop_money_currency_code  ,   
        total_tip_received as total_tip_received  ,   
        total_weight as total_weight  ,   
        updated_at as updated_at  ,   
        user_id as user_id  ,   
        uuid_ts as uuid_ts  ,   
        value as value   
        
From _6_a_907339_4_ae_5_406_f_ba_3_e_c_9_bf_93_f_03087.order_created

 

UNION ALL 

  
 -- find all the possible columns and create placeholders if the don't exist

		

		

Select 	admin_graphql_api_id as admin_graphql_api_id  ,   
        anonymous_id as anonymous_id  ,   
        app_id as app_id  ,   
        browser_ip as browser_ip  ,   
        buyer_accepts_marketing as buyer_accepts_marketing  ,   
        cart_token as cart_token  ,   
        checkout_id as checkout_id  ,   
        checkout_token as checkout_token  ,   
        client_details_accept_language as client_details_accept_language  ,   
        client_details_browser_height as client_details_browser_height  ,   
        client_details_browser_ip as client_details_browser_ip  ,   
        client_details_browser_width as client_details_browser_width  ,   
        client_details_user_agent as client_details_user_agent  ,   
        closed_at as closed_at  ,   
        confirmed as confirmed  ,   
        contact_email as contact_email  ,   
        context_destination_id as context_destination_id  ,   
        context_destination_type as context_destination_type  ,   
        context_integration_name as context_integration_name  ,   
        context_ip as context_ip  ,   
        context_library_name as context_library_name  ,   
        context_library_version as context_library_version  ,   
        context_request_ip as context_request_ip  ,   
        context_source_id as context_source_id  ,   
        context_source_type as context_source_type  ,   
        created_at as created_at  ,   
        currency as currency  ,   
        current_subtotal_price as current_subtotal_price  ,   
        current_subtotal_price_set_presentment_money_amount as current_subtotal_price_set_presentment_money_amount  ,   
        current_subtotal_price_set_presentment_money_currency_code as current_subtotal_price_set_presentment_money_currency_code  ,   
        current_subtotal_price_set_shop_money_amount as current_subtotal_price_set_shop_money_amount  ,   
        current_subtotal_price_set_shop_money_currency_code as current_subtotal_price_set_shop_money_currency_code  ,   
        current_total_discounts as current_total_discounts  ,   
        current_total_discounts_set_presentment_money_amount as current_total_discounts_set_presentment_money_amount  ,   
        current_total_discounts_set_presentment_money_currency_code as current_total_discounts_set_presentment_money_currency_code  ,   
        current_total_discounts_set_shop_money_amount as current_total_discounts_set_shop_money_amount  ,   
        current_total_discounts_set_shop_money_currency_code as current_total_discounts_set_shop_money_currency_code  ,   
        current_total_price as current_total_price  ,   
        current_total_price_set_presentment_money_amount as current_total_price_set_presentment_money_amount  ,   
        current_total_price_set_presentment_money_currency_code as current_total_price_set_presentment_money_currency_code  ,   
        current_total_price_set_shop_money_amount as current_total_price_set_shop_money_amount  ,   
        current_total_price_set_shop_money_currency_code as current_total_price_set_shop_money_currency_code  ,   
        current_total_tax as current_total_tax  ,   
        current_total_tax_set_presentment_money_amount as current_total_tax_set_presentment_money_amount  ,   
        current_total_tax_set_presentment_money_currency_code as current_total_tax_set_presentment_money_currency_code  ,   
        current_total_tax_set_shop_money_amount as current_total_tax_set_shop_money_amount  ,   
        current_total_tax_set_shop_money_currency_code as current_total_tax_set_shop_money_currency_code  ,   
        customer_locale as customer_locale  ,   
        discount_applications as discount_applications  ,   
        discount_codes as discount_codes  ,   
        email as email  ,   
        estimated_taxes as estimated_taxes  ,   
        event as event  ,   
        event_text as event_text  ,   
        financial_status as financial_status  ,   
        fulfillment_status as fulfillment_status  ,   
        fulfillments as fulfillments  ,   
        gateway as gateway  ,   
        id as id  ,   
        landing_site as landing_site  ,   
        landing_site_ref as landing_site_ref  ,   
        name as name  ,   
        note as note  ,   
        note_attributes as note_attributes  ,   
        number as number  ,   
        NULL as order_id  ,   
        order_number as order_number  ,   
        order_status_url as order_status_url  ,   
        original_timestamp as original_timestamp  ,   
        payment_details_avs_result_code as payment_details_avs_result_code  ,   
        payment_details_credit_card_bin as payment_details_credit_card_bin  ,   
        payment_details_credit_card_company as payment_details_credit_card_company  ,   
        payment_details_credit_card_number as payment_details_credit_card_number  ,   
        payment_details_cvv_result_code as payment_details_cvv_result_code  ,   
        payment_gateway_names as payment_gateway_names  ,   
        phone as phone  ,   
        presentment_currency as presentment_currency  ,   
        processed_at as processed_at  ,   
        processing_method as processing_method  ,   
        products as products  ,   
        received_at as received_at  ,   
        reference as reference  ,   
        referring_site as referring_site  ,   
        refunds as refunds  ,   
        sent_at as sent_at  ,   
        shipping_lines as shipping_lines  ,   
        source_identifier as source_identifier  ,   
        source_name as source_name  ,   
        subtotal_price as subtotal_price  ,   
        subtotal_price_set_presentment_money_amount as subtotal_price_set_presentment_money_amount  ,   
        subtotal_price_set_presentment_money_currency_code as subtotal_price_set_presentment_money_currency_code  ,   
        subtotal_price_set_shop_money_amount as subtotal_price_set_shop_money_amount  ,   
        subtotal_price_set_shop_money_currency_code as subtotal_price_set_shop_money_currency_code  ,   
        tags as tags  ,   
        NULL as tax  ,   
        tax_lines as tax_lines  ,   
        taxes_included as taxes_included  ,   
        test as test  ,   
        timestamp as timestamp  ,   
        token as token  ,   
        total_discounts as total_discounts  ,   
        total_discounts_set_presentment_money_amount as total_discounts_set_presentment_money_amount  ,   
        total_discounts_set_presentment_money_currency_code as total_discounts_set_presentment_money_currency_code  ,   
        total_discounts_set_shop_money_amount as total_discounts_set_shop_money_amount  ,   
        total_discounts_set_shop_money_currency_code as total_discounts_set_shop_money_currency_code  ,   
        total_line_items_price as total_line_items_price  ,   
        total_line_items_price_set_presentment_money_amount as total_line_items_price_set_presentment_money_amount  ,   
        total_line_items_price_set_presentment_money_currency_code as total_line_items_price_set_presentment_money_currency_code  ,   
        total_line_items_price_set_shop_money_amount as total_line_items_price_set_shop_money_amount  ,   
        total_line_items_price_set_shop_money_currency_code as total_line_items_price_set_shop_money_currency_code  ,   
        total_outstanding as total_outstanding  ,   
        total_price as total_price  ,   
        total_price_set_presentment_money_amount as total_price_set_presentment_money_amount  ,   
        total_price_set_presentment_money_currency_code as total_price_set_presentment_money_currency_code  ,   
        total_price_set_shop_money_amount as total_price_set_shop_money_amount  ,   
        total_price_set_shop_money_currency_code as total_price_set_shop_money_currency_code  ,   
        total_price_usd as total_price_usd  ,   
        total_shipping_price_set_presentment_money_amount as total_shipping_price_set_presentment_money_amount  ,   
        total_shipping_price_set_presentment_money_currency_code as total_shipping_price_set_presentment_money_currency_code  ,   
        total_shipping_price_set_shop_money_amount as total_shipping_price_set_shop_money_amount  ,   
        total_shipping_price_set_shop_money_currency_code as total_shipping_price_set_shop_money_currency_code  ,   
        total_tax as total_tax  ,   
        total_tax_set_presentment_money_amount as total_tax_set_presentment_money_amount  ,   
        total_tax_set_presentment_money_currency_code as total_tax_set_presentment_money_currency_code  ,   
        total_tax_set_shop_money_amount as total_tax_set_shop_money_amount  ,   
        total_tax_set_shop_money_currency_code as total_tax_set_shop_money_currency_code  ,   
        total_tip_received as total_tip_received  ,   
        total_weight as total_weight  ,   
        updated_at as updated_at  ,   
        user_id as user_id  ,   
        uuid_ts as uuid_ts  ,   
        NULL as value   
        
From _6_a_907339_4_ae_5_406_f_ba_3_e_c_9_bf_93_f_03087.order_fulfilled

 

UNION ALL 

  
 -- find all the possible columns and create placeholders if the don't exist

		

		

Select 	admin_graphql_api_id as admin_graphql_api_id  ,   
        anonymous_id as anonymous_id  ,   
        app_id as app_id  ,   
        browser_ip as browser_ip  ,   
        buyer_accepts_marketing as buyer_accepts_marketing  ,   
        cart_token as cart_token  ,   
        checkout_id as checkout_id  ,   
        checkout_token as checkout_token  ,   
        client_details_accept_language as client_details_accept_language  ,   
        client_details_browser_height as client_details_browser_height  ,   
        client_details_browser_ip as client_details_browser_ip  ,   
        client_details_browser_width as client_details_browser_width  ,   
        client_details_user_agent as client_details_user_agent  ,   
        NULL as closed_at  ,   
        confirmed as confirmed  ,   
        contact_email as contact_email  ,   
        context_destination_id as context_destination_id  ,   
        context_destination_type as context_destination_type  ,   
        context_integration_name as context_integration_name  ,   
        context_ip as context_ip  ,   
        context_library_name as context_library_name  ,   
        context_library_version as context_library_version  ,   
        context_request_ip as context_request_ip  ,   
        context_source_id as context_source_id  ,   
        context_source_type as context_source_type  ,   
        created_at as created_at  ,   
        currency as currency  ,   
        current_subtotal_price as current_subtotal_price  ,   
        current_subtotal_price_set_presentment_money_amount as current_subtotal_price_set_presentment_money_amount  ,   
        current_subtotal_price_set_presentment_money_currency_code as current_subtotal_price_set_presentment_money_currency_code  ,   
        current_subtotal_price_set_shop_money_amount as current_subtotal_price_set_shop_money_amount  ,   
        current_subtotal_price_set_shop_money_currency_code as current_subtotal_price_set_shop_money_currency_code  ,   
        current_total_discounts as current_total_discounts  ,   
        current_total_discounts_set_presentment_money_amount as current_total_discounts_set_presentment_money_amount  ,   
        current_total_discounts_set_presentment_money_currency_code as current_total_discounts_set_presentment_money_currency_code  ,   
        current_total_discounts_set_shop_money_amount as current_total_discounts_set_shop_money_amount  ,   
        current_total_discounts_set_shop_money_currency_code as current_total_discounts_set_shop_money_currency_code  ,   
        current_total_price as current_total_price  ,   
        current_total_price_set_presentment_money_amount as current_total_price_set_presentment_money_amount  ,   
        current_total_price_set_presentment_money_currency_code as current_total_price_set_presentment_money_currency_code  ,   
        current_total_price_set_shop_money_amount as current_total_price_set_shop_money_amount  ,   
        current_total_price_set_shop_money_currency_code as current_total_price_set_shop_money_currency_code  ,   
        current_total_tax as current_total_tax  ,   
        current_total_tax_set_presentment_money_amount as current_total_tax_set_presentment_money_amount  ,   
        current_total_tax_set_presentment_money_currency_code as current_total_tax_set_presentment_money_currency_code  ,   
        current_total_tax_set_shop_money_amount as current_total_tax_set_shop_money_amount  ,   
        current_total_tax_set_shop_money_currency_code as current_total_tax_set_shop_money_currency_code  ,   
        customer_locale as customer_locale  ,   
        discount_applications as discount_applications  ,   
        discount_codes as discount_codes  ,   
        email as email  ,   
        estimated_taxes as estimated_taxes  ,   
        event as event  ,   
        event_text as event_text  ,   
        financial_status as financial_status  ,   
        fulfillment_status as fulfillment_status  ,   
        fulfillments as fulfillments  ,   
        gateway as gateway  ,   
        id as id  ,   
        landing_site as landing_site  ,   
        landing_site_ref as landing_site_ref  ,   
        name as name  ,   
        note as note  ,   
        note_attributes as note_attributes  ,   
        number as number  ,   
        NULL as order_id  ,   
        order_number as order_number  ,   
        order_status_url as order_status_url  ,   
        original_timestamp as original_timestamp  ,   
        payment_details_avs_result_code as payment_details_avs_result_code  ,   
        payment_details_credit_card_bin as payment_details_credit_card_bin  ,   
        payment_details_credit_card_company as payment_details_credit_card_company  ,   
        payment_details_credit_card_number as payment_details_credit_card_number  ,   
        payment_details_cvv_result_code as payment_details_cvv_result_code  ,   
        payment_gateway_names as payment_gateway_names  ,   
        phone as phone  ,   
        presentment_currency as presentment_currency  ,   
        processed_at as processed_at  ,   
        processing_method as processing_method  ,   
        products as products  ,   
        received_at as received_at  ,   
        NULL as reference  ,   
        referring_site as referring_site  ,   
        NULL as refunds  ,   
        sent_at as sent_at  ,   
        shipping_lines as shipping_lines  ,   
        NULL as source_identifier  ,   
        source_name as source_name  ,   
        subtotal_price as subtotal_price  ,   
        subtotal_price_set_presentment_money_amount as subtotal_price_set_presentment_money_amount  ,   
        subtotal_price_set_presentment_money_currency_code as subtotal_price_set_presentment_money_currency_code  ,   
        subtotal_price_set_shop_money_amount as subtotal_price_set_shop_money_amount  ,   
        subtotal_price_set_shop_money_currency_code as subtotal_price_set_shop_money_currency_code  ,   
        tags as tags  ,   
        NULL as tax  ,   
        tax_lines as tax_lines  ,   
        taxes_included as taxes_included  ,   
        test as test  ,   
        timestamp as timestamp  ,   
        token as token  ,   
        total_discounts as total_discounts  ,   
        total_discounts_set_presentment_money_amount as total_discounts_set_presentment_money_amount  ,   
        total_discounts_set_presentment_money_currency_code as total_discounts_set_presentment_money_currency_code  ,   
        total_discounts_set_shop_money_amount as total_discounts_set_shop_money_amount  ,   
        total_discounts_set_shop_money_currency_code as total_discounts_set_shop_money_currency_code  ,   
        total_line_items_price as total_line_items_price  ,   
        total_line_items_price_set_presentment_money_amount as total_line_items_price_set_presentment_money_amount  ,   
        total_line_items_price_set_presentment_money_currency_code as total_line_items_price_set_presentment_money_currency_code  ,   
        total_line_items_price_set_shop_money_amount as total_line_items_price_set_shop_money_amount  ,   
        total_line_items_price_set_shop_money_currency_code as total_line_items_price_set_shop_money_currency_code  ,   
        total_outstanding as total_outstanding  ,   
        total_price as total_price  ,   
        total_price_set_presentment_money_amount as total_price_set_presentment_money_amount  ,   
        total_price_set_presentment_money_currency_code as total_price_set_presentment_money_currency_code  ,   
        total_price_set_shop_money_amount as total_price_set_shop_money_amount  ,   
        total_price_set_shop_money_currency_code as total_price_set_shop_money_currency_code  ,   
        total_price_usd as total_price_usd  ,   
        total_shipping_price_set_presentment_money_amount as total_shipping_price_set_presentment_money_amount  ,   
        total_shipping_price_set_presentment_money_currency_code as total_shipping_price_set_presentment_money_currency_code  ,   
        total_shipping_price_set_shop_money_amount as total_shipping_price_set_shop_money_amount  ,   
        total_shipping_price_set_shop_money_currency_code as total_shipping_price_set_shop_money_currency_code  ,   
        total_tax as total_tax  ,   
        total_tax_set_presentment_money_amount as total_tax_set_presentment_money_amount  ,   
        total_tax_set_presentment_money_currency_code as total_tax_set_presentment_money_currency_code  ,   
        total_tax_set_shop_money_amount as total_tax_set_shop_money_amount  ,   
        total_tax_set_shop_money_currency_code as total_tax_set_shop_money_currency_code  ,   
        total_tip_received as total_tip_received  ,   
        total_weight as total_weight  ,   
        updated_at as updated_at  ,   
        user_id as user_id  ,   
        uuid_ts as uuid_ts  ,   
        NULL as value   
        
From _6_a_907339_4_ae_5_406_f_ba_3_e_c_9_bf_93_f_03087.order_paid

  


-- End 
) as z 
order by order_number, 1